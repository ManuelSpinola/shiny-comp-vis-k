{
  "hash": "452be1ddb2dfd9002434b9831d8fa7ff",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"BioObserva\"\nsubtitle: \"Detección e identificación de especies en imágenes\"\nformat: html\nserver: shiny\n---\n\n\n::: {.cell context='setup'}\n\n:::\n\n\n# Con la ayuda de Noctua, el búho observador\n\n::: text-center\n![](www/logo_maritza.png){width=\"50%\"}\n\n*Ilustración por Gemini 2.0 Flash y Maritza Ramírez*\n:::\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"form-group shiny-input-container\" style=\"width:400px;\">\n<label class=\"control-label\" id=\"imagen-label\" for=\"imagen\">Escoge una imagen</label>\n<div class=\"input-group\">\n<label class=\"input-group-btn input-group-prepend\">\n<span class=\"btn btn-default btn-file\">\nSeleccionar...\n<input id=\"imagen\" class=\"shiny-input-file\" name=\"imagen\" type=\"file\" style=\"position: absolute !important; top: -99999px !important; left: -99999px !important;\"/>\n</span>\n</label>\n<input type=\"text\" class=\"form-control\" placeholder=\"Ningún archivo seleccionado\" readonly=\"readonly\"/>\n</div>\n<div id=\"imagen_progress\" class=\"progress active shiny-file-input-progress\">\n<div class=\"progress-bar\"></div>\n</div>\n</div>\n```\n\n:::\n:::\n\n\n\\\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"form-group shiny-input-container\" style=\"width:100%;\">\n<label class=\"control-label\" id=\"prompt-label\" for=\"prompt\">Tu solicitud (Ejemplo: que especie se ve en la imagen)</label>\n<input id=\"prompt\" type=\"text\" class=\"shiny-input-text form-control\" value=\"\" placeholder=\"Escribe aquí lo qué quieras saber de la imagen\" data-update-on=\"change\"/>\n</div>\n```\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<button id=\"goButton\" type=\"button\" class=\"btn btn-default action-button\">Envía tu solicitud</button>\n```\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"my_image\" class=\"shiny-image-output\" style=\"width:100%;height:auto;\"></div>\n```\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div style=\"white-space: pre-wrap; word-wrap: break-word; border: 1px solid #ccc; padding: 10px; border-radius: 6px; background: #f8f8f8;\">\n<div id=\"text1\" class=\"shiny-text-output\"></div>\n</div>\n```\n\n:::\n:::\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div style=\"margin-top: 20px;\">\n<div class=\"shiny-html-output gt_shiny\" id=\"results_table\"></div>\n</div>\n```\n\n:::\n:::\n\n\n\n\n::: {.cell context='server'}\n\n:::\n\n\npreservecb8f19efc8f58cfb\npreserve85035f48e05b08a2\npreserve9a16616361ad8fbf\n\n<!--html_preserve-->\n<script type=\"application/shiny-prerendered\" data-context=\"dependencies\">\n{\"type\":\"list\",\"attributes\":{},\"value\":[]}\n</script>\n<!--/html_preserve-->\n<!--html_preserve-->\n<script type=\"application/shiny-prerendered\" data-context=\"execution_dependencies\">\n{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"packages\"]}},\"value\":[{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"packages\",\"version\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"data.frame\"]},\"row.names\":{\"type\":\"integer\",\"attributes\":{},\"value\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"base\",\"bmp\",\"cli\",\"compiler\",\"coro\",\"crayon\",\"datasets\",\"dichromat\",\"digest\",\"dplyr\",\"ellmer\",\"evaluate\",\"farver\",\"fastmap\",\"fontawesome\",\"fs\",\"gargle\",\"generics\",\"ggplot2\",\"glue\",\"graphics\",\"grDevices\",\"grid\",\"gt\",\"gtable\",\"gtExtras\",\"htmltools\",\"htmlwidgets\",\"httpuv\",\"httr2\",\"igraph\",\"imager\",\"jpeg\",\"jsonlite\",\"knitr\",\"kuzco\",\"later\",\"lifecycle\",\"magrittr\",\"methods\",\"mime\",\"ollamar\",\"paletteer\",\"pillar\",\"pkgconfig\",\"png\",\"promises\",\"purrr\",\"R6\",\"rappdirs\",\"RColorBrewer\",\"Rcpp\",\"readbitmap\",\"rematch2\",\"rlang\",\"rmarkdown\",\"rstudioapi\",\"S7\",\"scales\",\"shiny\",\"stats\",\"stringi\",\"stringr\",\"tibble\",\"tidyr\",\"tidyselect\",\"tiff\",\"tools\",\"utils\",\"vctrs\",\"xfun\",\"xml2\",\"xtable\",\"yaml\"]},{\"type\":\"character\",\"attributes\":{},\"value\":[\"4.5.1\",\"0.3\",\"3.6.5\",\"4.5.1\",\"1.1.0\",\"1.5.3\",\"4.5.1\",\"2.0-0.1\",\"0.6.37\",\"1.1.4\",\"0.3.0\",\"1.0.4\",\"2.1.2\",\"1.2.0\",\"0.5.3\",\"1.6.6\",\"1.5.2\",\"0.1.4\",\"3.5.2\",\"1.8.0\",\"4.5.1\",\"4.5.1\",\"4.5.1\",\"1.0.0\",\"0.3.6\",\"0.6.0\",\"0.5.8.1\",\"1.6.4\",\"1.6.16\",\"1.2.1\",\"2.1.4\",\"1.0.3\",\"0.1-11\",\"2.0.0\",\"1.50\",\"0.0.4.9000\",\"1.4.2\",\"1.0.4\",\"2.0.3\",\"4.5.1\",\"0.13\",\"1.2.2\",\"1.6.0\",\"1.11.0\",\"2.0.3\",\"0.1-8\",\"1.3.3\",\"1.1.0\",\"2.6.1\",\"0.3.3\",\"1.1-3\",\"1.1.0\",\"0.1.5\",\"2.1.2\",\"1.1.6\",\"2.29\",\"0.17.1\",\"0.2.0\",\"1.4.0\",\"1.11.1\",\"4.5.1\",\"1.8.7\",\"1.5.1\",\"3.3.0\",\"1.3.1\",\"1.2.1\",\"0.1-12\",\"4.5.1\",\"4.5.1\",\"0.6.5\",\"0.52\",\"1.3.8\",\"1.8-4\",\"2.3.10\"]}]}]}\n</script>\n<!--/html_preserve-->",
    "supporting": [
      "BioObserva_app_k_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {
      "preserve85035f48e05b08a2": "\n<script type=\"application/shiny-prerendered\" data-context=\"server\">\nsource(\"my_view_llm_results.R\")\n\n# Mostrar la imagen cargada\nobserveEvent(input$imagen, {\n  req(input$imagen)\n  output$my_image <- renderImage({\n    list(\n      src = input$imagen$datapath,\n      contentType = input$imagen$type,\n      width = \"100%\",\n      height = \"auto\"\n    )\n  }, deleteFile = FALSE)\n})\n\n# Reactive expression para guardar los resultados del modelo\nresults <- reactiveVal()\n\n# Obtener respuesta del LLM\nobserveEvent(input$goButton, {\n  req(input$imagen, input$prompt)\n  res <- kuzco::llm_image_classification(\n    provider = \"google_gemini\",\n    llm_model = \"gemini-2.5-flash\",\n    backend = \"ellmer\",\n    additional_prompt = input$prompt,\n    image = input$imagen$datapath,\n    language = 'Spanish',\n    api_key = Sys.getenv(\"GOOGLE_API_KEY\")\n  )\n  results(res)\n  output$text1 <- renderText({\n    paste(\"Modelo respondió con\", length(res), \"resultados.\")\n  })\n})\n\n# Mostrar resultados con gt\noutput$results_table <- gt::render_gt({\n  req(results())\n  my_view_llm_results(results())\n})\n</script>\n",
      "preserve9a16616361ad8fbf": "\n<script type=\"application/shiny-prerendered\" data-context=\"server-extras\">\nojs_define <- function(..., .session = shiny::getDefaultReactiveDomain()) {\n  quos <- rlang::enquos(...)\n  vars <- rlang::list2(...)\n  nm <- names(vars)\n  if (is.null(nm)) {\n    nm <- rep_len(\"\", length(vars))\n  }\n  mapply(\n    function(q, nm, val) {\n      # Infer name, if possible\n      if (nm == \"\") {\n        tryCatch(\n          {\n            nm <- rlang::as_name(q)\n          },\n          error = function(e) {\n            code <- paste(collapse = \"\\n\", deparse(rlang::f_rhs(q)))\n            stop(\n              \"ojs_define() could not create a name for the argument: \",\n              code\n            )\n          }\n        )\n      }\n      .session$output[[nm]] <- val\n      outputOptions(.session$output, nm, suspendWhenHidden = FALSE)\n      .session$sendCustomMessage(\"ojs-export\", list(name = nm))\n      NULL\n    },\n    quos,\n    nm,\n    vars,\n    SIMPLIFY = FALSE,\n    USE.NAMES = FALSE\n  )\n  invisible()\n}\n</script>\n",
      "preservecb8f19efc8f58cfb": "\n<script type=\"application/shiny-prerendered\" data-context=\"server-start\">\nlibrary(shiny)\nlibrary(ellmer)\nlibrary(kuzco)\nlibrary(gt)\nlibrary(gargle)\n\n# Internal API key (replace with your actual API key)\nGEMINI_API_KEY <- Sys.getenv(\"GEMINI_API_KEY\")\nGOOGLE_API_KEY <- Sys.getenv(\"GOOGLE_API_KEY\")\n</script>\n"
    },
    "postProcess": true
  }
}